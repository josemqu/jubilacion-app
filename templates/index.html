<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Planner Pro - Planificaci√≥n Financiera Inteligente</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üí∞ Retirement Planner Pro</h1>
            <p class="subtitle">Simulaci√≥n avanzada de jubilaci√≥n con doble capital</p>
        </header>

        <div class="main-content">
            <!-- Panel de Inputs -->
            <div class="input-panel">
                <section class="input-section">
                    <h2>üìä Datos Personales</h2>
                    <div class="input-group">
                        <label for="edad_actual">Edad Actual</label>
                        <input type="range" id="edad_actual" min="18" max="70" value="30" oninput="updateValue(this)">
                        <span class="value-display" id="edad_actual_value">30 a√±os</span>
                    </div>
                    <div class="input-group">
                        <label for="edad_jubilacion">Edad de Jubilaci√≥n</label>
                        <input type="range" id="edad_jubilacion" min="50" max="80" value="65" oninput="updateValue(this)">
                        <span class="value-display" id="edad_jubilacion_value">65 a√±os</span>
                    </div>
                    <div class="input-group">
                        <label for="esperanza_vida">Esperanza de Vida</label>
                        <input type="range" id="esperanza_vida" min="65" max="100" value="85" oninput="updateValue(this)">
                        <span class="value-display" id="esperanza_vida_value">85 a√±os</span>
                    </div>
                </section>

                <section class="input-section">
                    <h2>üíµ Capital de Caja</h2>
                    <div class="input-group">
                        <label for="capital_inicial_caja">Capital Inicial</label>
                        <input type="number" id="capital_inicial_caja" value="50000" step="1000" oninput="updateValue(this)">
                        <span class="currency">USD</span>
                    </div>
                    <div class="input-group">
                        <label for="ingreso_mensual">Ingreso Mensual</label>
                        <input type="number" id="ingreso_mensual" value="5000" step="100" oninput="updateValue(this)">
                        <span class="currency">USD</span>
                    </div>
                    <div class="input-group">
                        <label for="gasto_mensual">Gasto Mensual Estimado</label>
                        <input type="number" id="gasto_mensual" value="3000" step="100" oninput="updateValue(this)">
                        <span class="currency">USD</span>
                    </div>
                    <div class="input-group">
                        <label for="tasa_retorno_caja_anual">Tasa de Retorno Anual (%)</label>
                        <input type="range" id="tasa_retorno_caja_anual" min="0" max="15" value="3" step="0.5" oninput="updateValue(this)">
                        <span class="value-display" id="tasa_retorno_caja_anual_value">3.0%</span>
                    </div>
                </section>

                <section class="input-section">
                    <h2>üè¶ Reserva de Jubilaci√≥n</h2>
                    <div class="input-group">
                        <label for="capital_inicial_reserva">Capital Inicial</label>
                        <input type="number" id="capital_inicial_reserva" value="100000" step="1000" oninput="updateValue(this)">
                        <span class="currency">USD</span>
                    </div>
                    <div class="input-group">
                        <label for="aporte_mensual_jubilacion">Aporte Mensual</label>
                        <input type="number" id="aporte_mensual_jubilacion" value="1000" step="50" oninput="updateValue(this)">
                        <span class="currency">USD</span>
                    </div>
                    <div class="input-group">
                        <label for="tasa_retorno_reserva_anual">Tasa de Retorno Anual (%)</label>
                        <input type="range" id="tasa_retorno_reserva_anual" min="0" max="20" value="8" step="0.5" oninput="updateValue(this)">
                        <span class="value-display" id="tasa_retorno_reserva_anual_value">8.0%</span>
                    </div>
                    <div class="input-group">
                        <label for="gasto_mensual_deseado">Gasto Mensual Deseado en Jubilaci√≥n</label>
                        <input type="number" id="gasto_mensual_deseado" value="3000" step="100" oninput="updateValue(this)">
                        <span class="currency">USD</span>
                    </div>
                </section>

                <section class="input-section">
                    <h2>üìà Par√°metros Econ√≥micos</h2>
                    <div class="input-group">
                        <label for="inflacion_anual">Inflaci√≥n Anual Estimada (%)</label>
                        <input type="range" id="inflacion_anual" min="0" max="10" value="3" step="0.5" oninput="updateValue(this)">
                        <span class="value-display" id="inflacion_anual_value">3.0%</span>
                    </div>
                </section>

                <button class="calculate-btn" onclick="calcular()">üöÄ Calcular Proyecci√≥n</button>
                
                <div class="utility-buttons">
                    <button class="utility-btn" onclick="window.retirementPlanner.exportConfig()" title="Descargar configuraci√≥n actual">
                        üíæ Exportar
                    </button>
                    <button class="utility-btn" onclick="document.getElementById('import-file').click()" title="Cargar configuraci√≥n desde archivo">
                        üìÇ Importar
                    </button>
                    <button class="utility-btn danger" onclick="if(confirm('¬øEst√°s seguro de que quieres borrar la configuraci√≥n guardada?')) { window.retirementPlanner.clearLocalStorage(); location.reload(); }" title="Borrar configuraci√≥n guardada">
                        üóëÔ∏è Limpiar
                    </button>
                </div>
                
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleFileImport(event)">
            </div>

            <!-- Panel de Resultados -->
            <div class="results-panel">
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Calculando tu futuro financiero...</p>
                </div>

                <div id="results" class="hidden">
                    <!-- Indicador de Estado -->
                    <div id="status-indicator" class="status-card">
                        <div class="status-icon" id="status-icon">‚è≥</div>
                        <h3 id="status-title">Analizando...</h3>
                        <p id="status-message">Procesando datos...</p>
                    </div>

                    <!-- M√©tricas Principales -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Capital Total al Jubilarse</div>
                            <div class="metric-value" id="capital_total_final">$0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Reserva de Jubilaci√≥n</div>
                            <div class="metric-value" id="capital_reserva_final">$0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Capital de Caja</div>
                            <div class="metric-value" id="capital_caja_final">$0</div>
                        </div>
                        <div class="metric-card highlight">
                            <div class="metric-label">Ingreso Mensual Perpetuo</div>
                            <div class="metric-value" id="ingreso_perpetuo">$0</div>
                            <div class="metric-subtitle">Sin agotar el capital</div>
                        </div>
                    </div>

                    <!-- Gr√°fico de Evoluci√≥n -->
                    <div class="chart-container">
                        <h3>üìä Evoluci√≥n del Patrimonio</h3>
                        <div id="chart"></div>
                    </div>

                    <!-- Tabla A√±o a A√±o -->
                    <div class="table-container">
                        <h3>üìÖ Evoluci√≥n A√±o a A√±o</h3>
                        <div class="table-wrapper">
                            <table id="tabla-anual">
                                <thead>
                                    <tr>
                                        <th>A√±o</th>
                                        <th>Edad</th>
                                        <th>Ingresos Trabajo</th>
                                        <th>Gastos</th>
                                        <th>Aportes</th>
                                        <th>Flujo Neto</th>
                                        <th>Rend. Caja</th>
                                        <th>Rend. Reserva</th>
                                        <th>Capital Caja</th>
                                        <th>Reserva Jubilaci√≥n</th>
                                        <th>Capital Total</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-body">
                                </tbody>
                            </table>
                        </div>


                    <!-- Advertencia de Aportes Omitidos -->
                    <div id="aportes-warning" class="warning-message hidden"></div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Nueva Secci√≥n: Metodolog√≠a y C√°lculos -->
        <section class="methodology-section">
            <div class="methodology-card">
                <h2>üßÆ Metodolog√≠a y C√°lculos Detallados</h2>
                <p class="methodology-intro">Esta calculadora utiliza un modelo de simulaci√≥n d√≠a a d√≠a para capturar el impacto real del inter√©s compuesto y la inflaci√≥n.</p>
                
                <div class="methodology-grid">
                    <div class="method-box">
                        <h3>1. Conversi√≥n de Tasas (TNA)</h3>
                        <p>Las tasas ingresadas se consideran <strong>TNA (Tasa Nominal Anual)</strong>. El sistema obtiene la tasa diaria mediante divisi√≥n simple, lo cual es el est√°ndar para tasas nominales:</p>
                        <code class="formula">tasa_diaria = TNA / 100 / 365</code>
                        <p class="extra">A diferencia de la TEA (Efectiva), la TNA no asume capitalizaci√≥n interna hasta que se aplica al saldo cada d√≠a.</p>
                    </div>

                    <div class="method-box">
                        <h3>2. Fase de Acumulaci√≥n</h3>
                        <p>Cada d√≠a, el sistema ejecuta este orden de operaciones:</p>
                        <ol>
                            <li><strong>Rendimiento:</strong> Se aplica la tasa diaria al saldo.</li>
                            <li><strong>Gastos:</strong> Se deduce el gasto diario ajustado por inflaci√≥n.</li>
                            <li><strong>Eventos Mensuales:</strong> Cada 30 d√≠as se procesan ingresos y aportes.</li>
                        </ol>
                    </div>

                    <div class="method-box">
                        <h3>3. Inflaci√≥n "Gota a Gota"</h3>
                        <p>La inflaci√≥n se aplica de forma exponencial diaria, simulando una p√©rdida de poder adquisitivo constante:</p>
                        <code class="formula">Multiplicador = (1 + tasa_diaria_inflacion) ^ dia</code>
                        <p class="extra">Esto significa que un gasto de $2.000 ma√±ana ser√° sutilmente m√°s caro que hoy, acumulando el efecto total al final del a√±o.</p>
                    </div>

                    <div class="method-box">
                        <h3>4. Fase de Retiro</h3>
                        <p>Durante la jubilaci√≥n, la prioridad de retiro es:</p>
                        <ol>
                            <li>Se agota primero el <strong>Capital de Caja</strong>.</li>
                            <li>Una vez en cero, se comienza a retirar de la <strong>Reserva de Jubilaci√≥n</strong>.</li>
                            <li>Si ambos llegan a cero, se registra un <strong>D√©ficit</strong> de fondos.</li>
                        </ol>
                    </div>

                    <div class="method-box full-width">
                        <h3>5. Ingreso Mensual Perpetuo</h3>
                        <p>Calcula cu√°nto se puede retirar cada mes sin que el capital total baje nunca (ajustado por inflaci√≥n):</p>
                        <code class="formula">Ingreso = Capital * [((1 + tasa_reserva)^30 - 1) - ((1 + tasa_inflacion)^30 - 1)]</code>
                        <p class="extra">B√°sicamente: retiras solo los intereses reales que sobran despu√©s de compensar la p√©rdida de valor por inflaci√≥n.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
